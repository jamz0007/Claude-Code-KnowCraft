---
argument-hint: <item-id> [--from=N] [--to=N] [--format=unified|side-by-side|timeline]
description: 对比知识条目的不同版本
allowed-tools: Read, Bash
---

# /kb-diff - 版本对比

## 功能
对比知识条目的不同版本,追踪知识演化过程。

## 使用方式

### 基本用法(对比最新两个版本)
```
/kb-diff 2026-01-04-105815

显示版本 4 和版本 5 的差异
```

### 指定版本范围
```
/kb-diff 2026-01-04-105815 --from=2 --to=5

对比版本 2 和版本 5
```

### 查看所有版本历史
```
/kb-diff 2026-01-04-105815 --format=timeline

显示完整的时间线和变更历史
```

### 并排对比
```
/kb-diff 2026-01-04-105815 --format=side-by-side

左右并排显示两个版本的差异
```

## 参数说明

- `item-id`: 知识条目 ID (必需)
- `--from`: 起始版本号 (默认: version-1)
- `--to`: 结束版本号 (默认: version)
- `--format`: 输出格式
  - `unified`: 统一格式 (默认)
  - `side-by-side`: 并排对比
  - `timeline`: 时间线视图

## 工作流程

### 1. 读取版本历史
```
扫描 knowledge/.versions/ 目录:
查找所有 item-id.v*.md 文件
按版本号排序
```

### 2. 读取指定版本
```
读取起始版本: item-id.v{from}.md
读取结束版本: item-id.v{to}.md (或当前版本)
```

### 3. 执行差异对比
```
使用 word-based diff 算法:
- 逐段落对比
- 逐句子对比
- 识别增删改
```

### 4. 格式化输出
```
根据 --format 参数:
- unified: 类似 git diff 的统一格式
- side-by-side: 左右并排
- timeline: 完整演化历史
```

## 输出格式详解

### Unified 格式 (默认)

```
/kb-diff 2026-01-04-105815

--- 版本 4 (2025-01-04 15:30)
+++ 版本 5 (2025-01-04 16:45)
@@ 概述 @@
-React Hooks 是 React 16.8 引入的新特性,让函数组件拥有状态。
+React Hooks 是 React 16.8 引入的新特性,让函数组件拥有状态和其他 React 特性。

@@ 常用 Hooks @@
+### useContext
+上下文共享 Hook。
+
 ### useReducer
 复杂状态管理 Hook。

@@ 优势 @@
 -代码更简洁
 +代码更简洁,逻辑复用更容易
 -逻辑复用更容易

变更摘要:
  - 修改: 3 处
  - 新增: 2 处
  - 删除: 0 处
  - 净增: +15 字
```

### Side-by-Side 格式

```
/kb-diff 2026-01-04-105815 --format=side-by-side

版本 4 (2025-01-04 15:30)              |  版本 5 (2025-01-04 16:45)
--------------------------------------|--------------------------------------
React Hooks 是 React 16.8 引入的      |  React Hooks 是 React 16.8 引入的
新特性,让函数组件拥有状态。           |  新特性,让函数组件拥有状态和其他 React 特性。
                                      |
### useState                         |  ### useState
状态管理 Hook。                       |  状态管理 Hook。
                                      |
### useEffect                        |  ### useEffect
副作用处理 Hook。                     |  副作用处理 Hook。
                                      |
+                                     |  ### useContext
+                                     |  上下文共享 Hook。
+                                     |
### useReducer                        |  ### useReducer
复杂状态管理 Hook。                   |  复杂状态管理 Hook。

## 优势                                 |  ## 优势
- 代码更简洁                          |  - 代码更简洁,逻辑复用更容易
- 逻辑复用更容易                      |  (合并)
                                      |
统计:                                 |  统计:
  字数: 180                           |    字数: 195
  段落: 8                             |    段落: 9
  链接: 2                             |    链接: 2
```

### Timeline 格式

```
/kb-diff 2026-01-04-105815 --format=timeline

知识演化时间线: React Hooks 深入理解
======================================

📅 版本 1 (2025-01-04 14:30:00)
   创建时间: 2025-01-04 14:30
   字数: 156
   标签: react, hooks
   变更: 初始创建

📅 版本 2 (2025-01-04 15:30:00)
   创建时间: 2025-01-04 15:30
   字数: 180
   标签: react, hooks, frontend
   变更: 添加 useContext 说明

   新增内容:
     + useContext 章节
     + 前端标签

   修改内容:
     ~ 优化概述描述

   净变化: +24 字

📅 版本 3 (2025-01-04 16:00:00)
   创建时间: 2025-01-04 16:00
   字数: 195
   标签: react, hooks, frontend, useState
   变更: 添加 useState 示例

   新增内容:
     + useState 代码示例
     + useState 标签

   净变化: +15 字

📅 版本 4 (2025-01-04 16:45:00)
   创建时间: 2025-01-04 16:45
   字数: 210
   标签: react, hooks, frontend, useState, useEffect
   变更: 添加 useEffect 详细说明

   新增内容:
     + useEffect 详细示例
     + useEffect 标签

   修改内容:
     ~ 优化代码示例格式

   净变化: +15 字

📅 版本 5 (2025-01-04 17:30:00) [当前版本]
   创建时间: 2025-01-04 17:30
   字数: 225
   标签: react, hooks, frontend, useState, useEffect, best-practices
   变更: 添加最佳实践和性能优化

   新增内容:
     + 最佳实践章节
     + 性能优化建议
     + best-practices 标签

   链接变更:
     + 添加链接到: 性能优化指南

   净变化: +15 字

演化趋势:
  ✍️  总编辑次数: 5
  📊 字数增长: 156 → 225 (+44.9%)
  🏷️  标签增长: 2 → 6 (+200%)
  🔗 链接增长: 0 → 2
  📈 平均每次增加: 17.25 字

知识点演化:
  基础概念 → 详细说明 → 代码示例 → 最佳实践
```

## 版本对比示例

### 对比跨越多个版本

```
/kb-diff 2026-01-04-105815 --from=1 --to=5

--- 版本 1 (2025-01-04 14:30)
+++ 版本 5 (2025-01-04 17:30)

## 核心变更摘要

从版本 1 到版本 5,该条目经历了显著扩展:

### 新增章节 (3 个)
  + 常用 Hooks (useState, useEffect, useContext)
  + Hooks 规则
  + 最佳实践

### 内容扩展
  - 字数: 156 → 225 (+44.9%)
  - 段落: 5 → 12 (+140%)
  - 代码示例: 0 → 4

### 结构优化
  + 添加清晰的层级结构
  + 添加代码示例
  + 添加最佳实践建议

### 知识深度演化
  版本 1: 基础概念介绍
  版本 2-3: 添加详细说明和示例
  版本 4-5: 添加实践指导和最佳实践

### 认知演化分析
  初始理解: Hooks 是新特性
  → 深入理解: 如何使用常用 Hooks
  → 实践应用: 最佳实践和性能优化

演化评分: ⭐⭐⭐⭐⭐ (5/5)
内容从概念介绍发展为完整的实践指南
```

## 变更类型标识

### 符号说明
- `+`: 新增内容
- `-`: 删除内容
- `~`: 修改内容
- `±`: 替换内容

### 颜色标识(终端支持时)
- 绿色: 新增
- 红色: 删除
- 黄色: 修改

## 统计信息

### 字数统计
```
版本 1: 156 字
版本 2: 180 字 (+24 字, +15.4%)
版本 3: 195 字 (+15 字, +8.3%)
版本 4: 210 字 (+15 字, +7.7%)
版本 5: 225 字 (+15 字, +7.1%)
```

### 段落统计
```
版本 1: 5 段
版本 2: 6 段
版本 3: 7 段
版本 4: 8 段
版本 5: 12 段
```

### 标签统计
```
版本 1: react, hooks (2 个)
版本 2: react, hooks, frontend (3 个)
版本 3: react, hooks, frontend, useState (4 个)
版本 4: react, hooks, frontend, useState, useEffect (5 个)
版本 5: react, hooks, frontend, useState, useEffect, best-practices (6 个)
```

## 高级功能

### 查看特定变更类型
```
/kb-diff 2026-01-04-105815 --type=added

仅显示新增内容
```

### 按时间范围对比
```
/kb-diff 2026-01-04-105815 --after="2025-01-04" --before="2025-01-05"

对比指定时间范围内的版本
```

### 导出差异报告
```
/kb-diff 2026-01-04-105815 --export=diff-report.md

生成 Markdown 格式的差异报告
```

## 注意事项

### 版本文件位置
```
knowledge/.versions/
├── 2026-01-04-105815.v1.md
├── 2026-01-04-105815.v2.md
├── 2026-01-04-105815.v3.md
└── 2026-01-04-105815.v4.md
```

### 性能考虑
- 大文件对比可能需要较长时间
- 跨越多版本的对比建议使用 timeline 格式
- Side-by-side 格式占用更多屏幕空间

### 版本编号
- 版本号从 1 开始
- 每次编辑自动递增
- 当前版本存储在主文件中

## 错误处理

### 版本不存在
```
❌ 错误: 版本 10 不存在
可用版本: 1, 2, 3, 4, 5
```

### 条目不存在
```
❌ 错误: 条目 2026-01-99-999999 不存在
请使用 /kb-list 查看所有条目
```

### 无版本历史
```
ℹ️  提示: 该条目没有版本历史
当前版本: 1
```

## 与其他命令的配合

### 查看版本历史后恢复
```
/kb-diff 2026-01-04-105815 --format=timeline
# 发现版本 3 更好
/kb-restore 2026-01-04-105815 --version=3
```

### 对比后编辑
```
/kb-diff 2026-01-04-105815
# 发现某个版本有错误
/kb-edit 2026-01-04-105815 --field=content
```

### 导出版本对比
```
/kb-diff 2026-01-04-105815 --format=timeline --export=evolution.md
分享知识演化过程
```

## 实用场景

### 1. 学习知识演化
```
查看自己如何逐步理解一个概念:
/kb-diff item-id --format=timeline
```

### 2. 恢复错误编辑
```
不小心删除了重要内容:
/kb-diff item-id
找到被删除的版本,然后恢复
```

### 3. 对比理解变化
```
查看对某个概念的认知变化:
/kb-diff item-id --from=1 --to=latest
```

### 4. 审查编辑历史
```
查看最近几次编辑的影响:
/kb-diff item-id --from=3 --to=5
```

## 扩展功能(未来)

### 智能差异分析
```
/kb-diff item-id --analyze

自动分析:
- 内容质量提升
- 知识深度增长
- 结构改进
- 认知演化模式
```

### 可视化差异
```
/kb-diff item-id --format=visual

生成交互式可视化图表
```

### 协作差异
```
/kb-diff item-id1 item-id2

对比两个不同条目的相似度
```

### AI 驱动的变更总结
```
/kb-diff item-id --summary

使用 AI 自动生成变更总结
```
